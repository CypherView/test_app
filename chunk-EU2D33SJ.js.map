{
  "version": 3,
  "sources": ["src/app/features/administration/components/assets/asset-move-form/asset-move-form.component.ts", "src/app/features/administration/components/assets/asset-move-form/asset-move-form.component.html"],
  "sourcesContent": ["import { CommonModule } from '@angular/common';\nimport {\n  ChangeDetectorRef,\n  Component,\n  DestroyRef,\n  effect,\n  inject,\n  OnInit,\n  signal,\n} from '@angular/core';\nimport { takeUntilDestroyed } from '@angular/core/rxjs-interop';\nimport { FormGroup, ReactiveFormsModule, Validators } from '@angular/forms';\nimport { ButtonModule } from 'primeng/button';\nimport { DynamicDialogRef, DynamicDialogConfig } from 'primeng/dynamicdialog';\n\nimport {\n  EntitiesService,\n  AssetResponse,\n  AssetMoveRequest,\n  ClientListItem,\n  AccountsService,\n} from '../../../../../api';\nimport {\n  hasProperty,\n  isDefined,\n  isNullOrUndefined,\n} from '../../../../../shared/utils';\nimport { BroadcastEventMessageService } from '../../../services/broadcast-event-messages.service';\nimport {\n  createAutocompleteField,\n  createDropdownField,\n  FormAction,\n  FormFieldConfig,\n} from '../../../../../shared/models';\nimport { DynamicFormComponent } from '../../../../../shared/components/forms/dynamic-form/dynamic-form.component';\nimport { Subject, debounceTime, switchMap, of, catchError } from 'rxjs';\nimport { UtilityService } from '../../../../../core/services/utility.service';\nimport { SEARCH_DEBOUNCE_TIME } from '../../../../../core/models';\n\n@Component({\n  selector: 'app-asset-move-form',\n  imports: [\n    CommonModule,\n    ReactiveFormsModule,\n    ButtonModule,\n    DynamicFormComponent,\n  ],\n  templateUrl: './asset-move-form.component.html',\n  styleUrl: './asset-move-form.component.scss',\n})\nexport class AssetMoveFormComponent implements OnInit {\n  private readonly entitiesService = inject(EntitiesService);\n  private readonly broadcastService = inject(BroadcastEventMessageService);\n  private readonly utilityService = inject(UtilityService);\n  private readonly accountsService = inject(AccountsService);\n  protected readonly destroyRef = inject(DestroyRef);\n  private readonly dialogRef = inject(DynamicDialogRef);\n  private readonly dialogConfig = inject(DynamicDialogConfig);\n\n  ownerId: string | null = null;\n  assetId: string | null = null;\n  protected formFields: FormFieldConfig[] = [];\n  clientsSearchResults = signal<ClientListItem[] | undefined>(undefined);\n  private readonly searchSubject = new Subject<string>();\n  private readonly cdr = inject(ChangeDetectorRef);\n  protected actions: FormAction[] = [\n    {\n      label: 'Cancel',\n      action: () => this.onCancel(),\n      severity: 'secondary',\n    },\n    {\n      label: 'Ok',\n      action: (formData: FormGroup) => {\n        const value = {\n          ...formData.value,\n          destinationClientId: formData.value['destinationClientId']?.id,\n        };\n        this.onWizardComplete(value as AssetMoveRequest);\n      },\n      severity: 'primary',\n      disabled: (form?: FormGroup) => {\n        if (isNullOrUndefined(form)) return true;\n        return form.pristine || form.invalid;\n      },\n    },\n  ];\n\n  constructor() {\n    effect(() => {\n      const searchResults = this.clientsSearchResults();\n      const field = this.formFields.find(\n        (f) => f.key === 'destinationClientId',\n      );\n      if (field?.props) {\n        // Update the suggestions\n        field.props = {\n          ...field.props,\n          suggestions: searchResults,\n        };\n      }\n      this.cdr.detectChanges();\n    });\n  }\n\n  ngOnInit(): void {\n    if (isDefined(this.dialogConfig.data)) {\n      this.ownerId = this.dialogConfig.data.ownerId ?? null;\n\n      // Get the asset ID from dialog data\n      this.assetId = this.dialogConfig.data.assetId ?? null;\n    }\n    this.formFields = [\n      createAutocompleteField(\n        'destinationClientId',\n        'Destination Client',\n        [],\n        this.clientsSearchResults(),\n        this.searchClient.bind(this),\n        {\n          layout: 'horizontal',\n          labelWidth: '1/3',\n          name: 'destinationClientId',\n          props: {\n            appendTo: 'body',\n            showClear: true,\n            multiple: false,\n            field: 'name',\n            completeOnFocus: false,\n            typeahead: true,\n            showEmptyMessage: true,\n            emptyMessage: 'No clients found',\n          },\n        },\n      ),\n      createDropdownField(\n        'includeDevice',\n        'Include Device',\n        [\n          {\n            label: 'Yes',\n            value: true,\n          },\n          {\n            label: 'No',\n            value: false,\n          },\n        ],\n        true,\n        {\n          layout: 'horizontal',\n          labelWidth: '1/3',\n          name: 'includeDevice',\n          props: {\n            appendTo: 'body',\n          },\n          validations: [\n            {\n              name: 'required',\n              validator: Validators.required,\n              message: 'Include Device is required',\n            },\n          ],\n        },\n      ),\n      createDropdownField(\n        'includeSimCard',\n        'Include Sim Card',\n        [\n          {\n            label: 'Yes',\n            value: true,\n          },\n          {\n            label: 'No',\n            value: false,\n          },\n        ],\n        true,\n        {\n          layout: 'horizontal',\n          labelWidth: '1/3',\n          name: 'includeSimCard',\n          props: {\n            appendTo: 'body',\n          },\n        },\n      ),\n    ];\n    this.setUpClientsSearch();\n  }\n\n  private setUpClientsSearch(): void {\n    this.searchSubject\n      .pipe(\n        debounceTime(SEARCH_DEBOUNCE_TIME),\n        takeUntilDestroyed(this.destroyRef),\n        switchMap((searchTerm) => {\n          const trimmedSearchTerm = searchTerm.trim();\n\n          if (trimmedSearchTerm.length === 0) {\n            return of({ items: [] });\n          }\n\n          const filters = {\n            state: { value: 'active', operator: '=' },\n            name: { value: `*${trimmedSearchTerm}*`, operator: '=' },\n          };\n          const rqlFilter = this.utilityService.constructRqlFilter(filters);\n\n          return this.accountsService\n            .listClients(this.ownerId ?? '', 0, 10, 'name', rqlFilter)\n            .pipe(\n              catchError(() => {\n                return of({ items: [] });\n              }),\n            );\n        }),\n      )\n      .subscribe({\n        next: (data) => {\n          if (isDefined(data) && hasProperty(data, 'items')) {\n            this.clientsSearchResults.set(\n              isNullOrUndefined(data.items) ? [] : data.items,\n            );\n          }\n        },\n        error: () => {\n          this.clientsSearchResults.set([]);\n        },\n      });\n  }\n\n  searchClient(searchTerm: string) {\n    this.clientsSearchResults.set(undefined);\n    this.searchSubject.next(searchTerm);\n  }\n\n  onWizardComplete(context: AssetMoveRequest): void {\n    if (isNullOrUndefined(this.assetId)) {\n      return;\n    }\n\n    this.entitiesService\n      .moveAsset(this.assetId, context)\n      .pipe(takeUntilDestroyed(this.destroyRef))\n      .subscribe({\n        next: (response: AssetResponse) => {\n          this.broadcastService.broadcast('entity-updated', {\n            entityType: 'asset',\n            operation: 'update',\n            entityId: response.id,\n          });\n          this.dialogRef.close(response);\n        },\n        error: () => {},\n      });\n  }\n\n  // Update cancel to close dialog with no result\n  onCancel(): void {\n    this.dialogRef.close();\n  }\n}\n", "<span class=\"muted text-justify\"\n  >Select the destination client into which you'd like to move this asset. The\n  asset will be copied to the new client and then deleted in this client.</span\n>\n<div class=\"p-fluid mt-4\">\n  <app-dynamic-form [fields]=\"formFields\" [actions]=\"actions\">\n  </app-dynamic-form>\n</div>\n"],
  "mappings": "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",
  "names": []
}
