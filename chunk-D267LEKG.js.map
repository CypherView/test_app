{
  "version": 3,
  "sources": ["src/app/features/app-store/services/app-installation.service.ts"],
  "sourcesContent": ["import { Injectable, inject } from '@angular/core';\nimport { HttpClient, HttpParams } from '@angular/common/http';\nimport { Observable } from 'rxjs';\nimport { map } from 'rxjs/operators';\nimport {\n  AppInstallationApiResponse,\n  AppInstallationListApiResponse,\n  InstallAppRequest,\n  UpdateAppConfigurationRequest,\n  InstallationListQueryParams,\n} from '../models/api/app-store-api.models';\nimport { ApiUrlService } from '../../../core/services/api-url.service';\n\n/**\n * Frontend model for app installation\n */\nexport interface AppInstallation {\n  id: string;\n  ownerId: string;\n  appId: string;\n  appName: string;\n  isEnabled: boolean;\n  configuration: Record<string, unknown>;\n  createdAt: string;\n  updatedAt: string;\n}\n\n/**\n * Service for managing app installations\n */\n@Injectable({\n  providedIn: 'root',\n})\nexport class AppInstallationService {\n  private readonly http = inject(HttpClient);\n  private readonly apiUrlService = inject(ApiUrlService);\n  private readonly baseUrl: string;\n\n  constructor() {\n    this.baseUrl = `${this.apiUrlService.getCurrentApiUrl()}/appstore/installations`;\n  }\n\n  /**\n   * Get all app installations for a user/organization\n   * @param params Query parameters for filtering\n   */\n  getInstallations(\n    params?: InstallationListQueryParams,\n  ): Observable<AppInstallation[]> {\n    let httpParams = new HttpParams();\n\n    if (params) {\n      if (params.owner !== undefined) {\n        httpParams = httpParams.set('owner', params.owner);\n      }\n      if (params.offset !== undefined) {\n        httpParams = httpParams.set('offset', params.offset.toString());\n      }\n      if (params.limit !== undefined) {\n        httpParams = httpParams.set('limit', params.limit.toString());\n      }\n      if (params.sort !== undefined) {\n        httpParams = httpParams.set('sort', params.sort);\n      }\n      if (params.filter !== undefined) {\n        httpParams = httpParams.set('filter', params.filter);\n      }\n    }\n\n    return this.http\n      .get<AppInstallationListApiResponse>(this.baseUrl, {\n        params: httpParams,\n      })\n      .pipe(\n        map((response) =>\n          response.items\n            .filter((item) => item != null)\n            .map((item) => this.mapFromApi(item)),\n        ),\n      );\n  }\n\n  /**\n   * Get a specific installation by ID\n   * @param id Installation ID\n   * @param owner Optional owner filter\n   */\n  getInstallation(\n    id: string,\n    owner?: string,\n  ): Observable<AppInstallation | null> {\n    let httpParams = new HttpParams();\n    if (owner !== undefined) {\n      httpParams = httpParams.set('owner', owner);\n    }\n\n    return this.http\n      .get<AppInstallationApiResponse>(`${this.baseUrl}/${id}`, {\n        params: httpParams,\n      })\n      .pipe(map((response) => this.mapFromApi(response)));\n  }\n\n  /**\n   * Install an app for a user/organization\n   * @param appId The app to install\n   * @param ownerId The owner (user/org) installing the app\n   * @param configuration Optional initial configuration\n   * @param appName Optional app name for display purposes\n   * @param developerId Optional developer ID for tracking purposes\n   */\n  installApp(\n    appId: string,\n    ownerId: string,\n    configuration?: Record<string, unknown>,\n    appName?: string,\n    developerId?: string,\n  ): Observable<AppInstallation> {\n    const request: InstallAppRequest = {\n      appId,\n      ownerId,\n      configuration,\n      appName: appName ?? 'Unknown App',\n      developerId: developerId ?? 'Unknown Developer',\n    };\n\n    return this.http\n      .post<AppInstallationApiResponse>(this.baseUrl, request)\n      .pipe(map((response) => this.mapFromApi(response)));\n  }\n\n  /**\n   * Uninstall an app\n   * @param id Installation ID\n   * @param owner Optional owner filter\n   */\n  uninstallApp(id: string, owner: string): Observable<AppInstallation> {\n    const httpParams = new HttpParams().set('owner', owner);\n\n    return this.http\n      .delete<AppInstallationApiResponse>(`${this.baseUrl}/${id}`, {\n        params: httpParams,\n      })\n      .pipe(map((response) => this.mapFromApi(response)));\n  }\n\n  /**\n   * Update app configuration\n   * @param id Installation ID\n   * @param ownerId Owner ID\n   * @param configuration New configuration\n   */\n  updateConfiguration(\n    id: string,\n    ownerId: string,\n    configuration: Record<string, unknown>,\n  ): Observable<AppInstallation> {\n    const request: UpdateAppConfigurationRequest = {\n      ownerId,\n      configuration,\n    };\n\n    return this.http\n      .put<AppInstallationApiResponse>(\n        `${this.baseUrl}/${id}/config`,\n        request,\n      )\n      .pipe(map((response) => this.mapFromApi(response)));\n  }\n\n  /**\n   * Maps API response to frontend model\n   */\n  private mapFromApi(apiResponse: AppInstallationApiResponse): AppInstallation {\n    return {\n      id: apiResponse.id,\n      ownerId: apiResponse.ownerId,\n      appId: apiResponse.appId,\n      appName: apiResponse.appName,\n      isEnabled: apiResponse.isEnabled,\n      configuration: apiResponse.configuration,\n      createdAt: apiResponse.createdDate,\n      updatedAt: apiResponse.updatedDate,\n    };\n  }\n}\n"],
  "mappings": ";;;;;;;;;;;;;;AAiCM,IAAO,yBAAP,MAAO,wBAAsB;EAChB,OAAO,OAAO,UAAU;EACxB,gBAAgB,OAAO,aAAa;EACpC;EAEjB,cAAA;AACE,SAAK,UAAU,GAAG,KAAK,cAAc,iBAAgB,CAAE;EACzD;;;;;EAMA,iBACE,QAAoC;AAEpC,QAAI,aAAa,IAAI,WAAU;AAE/B,QAAI,QAAQ;AACV,UAAI,OAAO,UAAU,QAAW;AAC9B,qBAAa,WAAW,IAAI,SAAS,OAAO,KAAK;MACnD;AACA,UAAI,OAAO,WAAW,QAAW;AAC/B,qBAAa,WAAW,IAAI,UAAU,OAAO,OAAO,SAAQ,CAAE;MAChE;AACA,UAAI,OAAO,UAAU,QAAW;AAC9B,qBAAa,WAAW,IAAI,SAAS,OAAO,MAAM,SAAQ,CAAE;MAC9D;AACA,UAAI,OAAO,SAAS,QAAW;AAC7B,qBAAa,WAAW,IAAI,QAAQ,OAAO,IAAI;MACjD;AACA,UAAI,OAAO,WAAW,QAAW;AAC/B,qBAAa,WAAW,IAAI,UAAU,OAAO,MAAM;MACrD;IACF;AAEA,WAAO,KAAK,KACT,IAAoC,KAAK,SAAS;MACjD,QAAQ;KACT,EACA,KACC,IAAI,CAAC,aACH,SAAS,MACN,OAAO,CAAC,SAAS,QAAQ,IAAI,EAC7B,IAAI,CAAC,SAAS,KAAK,WAAW,IAAI,CAAC,CAAC,CACxC;EAEP;;;;;;EAOA,gBACE,IACA,OAAc;AAEd,QAAI,aAAa,IAAI,WAAU;AAC/B,QAAI,UAAU,QAAW;AACvB,mBAAa,WAAW,IAAI,SAAS,KAAK;IAC5C;AAEA,WAAO,KAAK,KACT,IAAgC,GAAG,KAAK,OAAO,IAAI,EAAE,IAAI;MACxD,QAAQ;KACT,EACA,KAAK,IAAI,CAAC,aAAa,KAAK,WAAW,QAAQ,CAAC,CAAC;EACtD;;;;;;;;;EAUA,WACE,OACA,SACA,eACA,SACA,aAAoB;AAEpB,UAAM,UAA6B;MACjC;MACA;MACA;MACA,SAAS,WAAW;MACpB,aAAa,eAAe;;AAG9B,WAAO,KAAK,KACT,KAAiC,KAAK,SAAS,OAAO,EACtD,KAAK,IAAI,CAAC,aAAa,KAAK,WAAW,QAAQ,CAAC,CAAC;EACtD;;;;;;EAOA,aAAa,IAAY,OAAa;AACpC,UAAM,aAAa,IAAI,WAAU,EAAG,IAAI,SAAS,KAAK;AAEtD,WAAO,KAAK,KACT,OAAmC,GAAG,KAAK,OAAO,IAAI,EAAE,IAAI;MAC3D,QAAQ;KACT,EACA,KAAK,IAAI,CAAC,aAAa,KAAK,WAAW,QAAQ,CAAC,CAAC;EACtD;;;;;;;EAQA,oBACE,IACA,SACA,eAAsC;AAEtC,UAAM,UAAyC;MAC7C;MACA;;AAGF,WAAO,KAAK,KACT,IACC,GAAG,KAAK,OAAO,IAAI,EAAE,WACrB,OAAO,EAER,KAAK,IAAI,CAAC,aAAa,KAAK,WAAW,QAAQ,CAAC,CAAC;EACtD;;;;EAKQ,WAAW,aAAuC;AACxD,WAAO;MACL,IAAI,YAAY;MAChB,SAAS,YAAY;MACrB,OAAO,YAAY;MACnB,SAAS,YAAY;MACrB,WAAW,YAAY;MACvB,eAAe,YAAY;MAC3B,WAAW,YAAY;MACvB,WAAW,YAAY;;EAE3B;;qCAvJW,yBAAsB;EAAA;4EAAtB,yBAAsB,SAAtB,wBAAsB,WAAA,YAFrB,OAAM,CAAA;;;sEAEP,wBAAsB,CAAA;UAHlC;WAAW;MACV,YAAY;KACb;;;",
  "names": []
}
