{
  "version": 3,
  "sources": ["src/app/shared/components/forms/modal-list-form/modal-list-form.component.ts", "src/app/shared/components/forms/modal-list-form/modal-list-form.component.html"],
  "sourcesContent": ["import {\n  Component,\n  inject,\n  ChangeDetectionStrategy,\n  effect,\n} from '@angular/core';\nimport { FormGroup } from '@angular/forms';\nimport { CommonModule } from '@angular/common';\nimport { ButtonModule } from 'primeng/button';\nimport { DynamicDialogRef, DynamicDialogConfig } from 'primeng/dynamicdialog';\nimport { FormFieldConfig, FormAction } from '../../../models/form-field.model';\nimport { DynamicFormComponent } from '../dynamic-form/dynamic-form.component';\nimport { isDefined, isNullOrUndefined } from '../../../utils';\n\n@Component({\n  selector: 'app-modal-list-form',\n  imports: [CommonModule, ButtonModule, DynamicFormComponent],\n  templateUrl: './modal-list-form.component.html',\n  changeDetection: ChangeDetectionStrategy.OnPush,\n})\nexport class ModalListFormComponent {\n  _fields: FormFieldConfig[] = [];\n  private readonly _fieldsFn: (() => FormFieldConfig[]) | undefined;\n  _initialData: Record<string, unknown> = {};\n  _actions: FormAction[] = [];\n  _subHeader = '';\n\n  private form?: FormGroup;\n\n  private readonly dialogRef = inject(DynamicDialogRef);\n  private readonly dialogConfig = inject(DynamicDialogConfig);\n\n  constructor() {\n    if (isDefined(this.dialogConfig?.data)) {\n      const maybeFn = this.dialogConfig.data.fieldsFn;\n      if (typeof maybeFn === 'function') {\n        this._fieldsFn = maybeFn as () => FormFieldConfig[];\n        // Initial evaluation\n        this._fields = this._fieldsFn() ?? [];\n        // Reactive effect: re-run whenever underlying signals used by function change\n        effect(() => {\n          if (this._fieldsFn) {\n            const newFields = this._fieldsFn();\n            // Replace only if reference changed to avoid unnecessary churn\n            // Replace only if reference changed (defensive check)\n            if (Array.isArray(newFields) && newFields !== this._fields) {\n              this._fields = [...newFields];\n            }\n          }\n        });\n      } else {\n        this._fields = this.dialogConfig.data.fields ?? [];\n      }\n      this._initialData = this.dialogConfig.data.initialData ?? {};\n      this._actions = this.dialogConfig.data.actions ?? [];\n      this._subHeader = this.dialogConfig.data.subHeader ?? '';\n    } else {\n      this.dialogRef.close();\n    }\n  }\n\n  /**\n   * Handles the form ready event from the nested DynamicFormComponent.\n   * Patches initial data.\n   * @param form The form group instance.\n   */\n  handleFormReady(form: FormGroup): void {\n    this.form = form;\n    if (isDefined(this._initialData) && isDefined(this.form)) {\n      this.form.patchValue(this._initialData, { emitEvent: false });\n    }\n  }\n\n  /**\n   * Determines if an action button should be visible.\n   * @param action The form action configuration.\n   * @returns True if visible, false otherwise.\n   */\n  isVisible(action: FormAction): boolean {\n    if (typeof action.visible === 'function') {\n      return action.visible(this.form);\n    }\n    return action.visible ?? true;\n  }\n\n  /**\n   * Determines if an action button should be disabled.\n   * @param action The form action configuration.\n   * @returns True if disabled, false otherwise.\n   */\n  isDisabled(action: FormAction): boolean {\n    if (typeof action.disabled === 'function') {\n      return action.disabled(this.form);\n    }\n    // Special case for submit type: disable if form is invalid\n    if (action.type === 'submit' && this.form) {\n      return (action.disabled ?? false) || this.form.invalid;\n    }\n    return action.disabled ?? false;\n  }\n\n  /**\n   * Handles button clicks in the modal footer.\n   * Executes the action's callback or handles default submit/cancel.\n   * @param action The form action configuration.\n   */\n  handleAction(action: FormAction): void {\n    // If there's a custom action handler, validate first then let it handle everything\n    if (action.action && this.form) {\n      if (action.type === 'submit' && this.form.invalid) {\n        // Don't call the action if form is invalid on submit\n        this.form.markAllAsTouched();\n        return;\n      }\n      action.action(this.form);\n      return; // Don't proceed with default behavior\n    }\n\n    // Default behavior only if no custom action handler\n    if (this.form && action.type === 'submit') {\n      if (this.form.valid) {\n        this.dialogRef.close(this.form.getRawValue());\n      } else {\n        this.form.markAllAsTouched();\n      }\n    } else if (action.type === 'cancel' || isNullOrUndefined(this.form)) {\n      this.dialogRef.close();\n    }\n  }\n\n  /**\n   * TrackBy function for rendering action buttons.\n   * @param index The index of the action.\n   * @param action The form action configuration.\n   * @returns A unique key for the action.\n   */\n  trackByLabel(index: number, action: FormAction): string {\n    return action.label ?? `action-${index}`;\n  }\n}\n", "<div class=\"modal-list-form-content p-fluid p-3\">\n  @if (_subHeader) {\n    <p class=\"mb-4\">\n      {{ _subHeader }}\n    </p>\n  }\n  <app-dynamic-form\n    [fields]=\"_fields\"\n    [hideActions]=\"true\"\n    (formReady)=\"handleFormReady($event)\"\n  >\n  </app-dynamic-form>\n</div>\n\n<!-- Footer with Action Buttons -->\n<div\n  class=\"modal-list-form-footer flex justify-end gap-2 p-3 border-t border-surface-border\"\n>\n  @for (action of _actions; track trackByLabel($index, action)) {\n    @if (isVisible(action)) {\n      <p-button\n        [label]=\"action.label\"\n        [icon]=\"action.icon\"\n        [styleClass]=\"action.styleClass\"\n        [severity]=\"action.severity\"\n        [disabled]=\"isDisabled(action)\"\n        (onClick)=\"handleAction(action)\"\n      ></p-button>\n    }\n  }\n</div>\n"],
  "mappings": "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",
  "names": []
}
